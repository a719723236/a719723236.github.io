{"version":3,"sources":["utils/use-optimistic-options.ts","utils/project.ts","utils/use-async.ts","components/error-boundary.tsx","App.tsx","reportWebVitals.ts","context/index.tsx","components/profiler.tsx","index.tsx","utils/http.ts","auth-provider.ts","utils/index.ts","components/lib.tsx","context/auth_context.tsx"],"names":["useConfig","queryKey","callBack","wrangingMsg","queryClient","useQueryClient","onSuccess","invalidateQueries","onMutate","target","cancelQueries","previousItems","getQueryData","setQueryData","old","onError","error","newItem","context","wrangMsg","msgTitle","msgContent","Modal","warning","title","content","useDeleteConfig","filter","item","id","useEditConfig","map","useAddConfig","useProjects","param","client","useHttp","useQuery","cleanObject","data","useEditProject","config","useMutation","params","method","useAddProject","useProject","enabled","useDeleteProject","useEditTask","defaultInitialState","stat","defaultConfig","throwOnError","useAsync","initialState","useState","state","setState","setData","useCallback","setError","mountedRef","useMountedRef","retry","setRetry","run","promise","runConfig","then","Error","prevState","current","catch","Promise","reject","isIdle","isLoading","isSuccess","isError","ErrorBoundary","this","props","fallbackRender","children","React","Component","AuthenticatedApp","lazy","UnauthenticatedApp","App","user","useAuth","className","FullPageErrorFallBack","Suspense","fallback","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","AppProviders","QueryClientProvider","QueryClient","queue","setInterval","length","queueTosend","console","log","Profiler","metadata","phases","onRender","phase","actualDuration","baseDuration","startTime","commitTime","interactions","includes","push","loadServer","ReactDOM","render","StrictMode","document","getElementById","apiUrl","process","http","endpoint","a","token","headers","customConfig","Authorization","toUpperCase","qs","body","JSON","stringify","window","fetch","response","status","auth","location","reload","message","json","ok","localStorageKey","getToken","localStorage","getItem","handleUserResponse","setItem","login","register","logout","removeItem","object","result","Object","keys","forEach","key","value","undefined","isVoid","useMount","callback","useEffect","useDebounce","delay","debounceValue","setDebounceValue","timeOut","setTimeout","clearTimeout","useDocumentTitle","keepOnUnmount","oldTitle","useRef","resetRoute","href","origin","useProjectIdInUrl","useLocation","pathname","match","Number","useProjectInUrl","delComfirmModal","mutate","confirmTitle","confirmContent","confirm","onOk","cancelText","okText","maskClosable","Row","styled","div","between","marginBottom","gap","FullPage","FullPageLoading","size","ErrorBox","ButtonNoPadding","Button","Text","type","ScreenContainer","bootstrapUser","AuthContext","createContext","displayName","AuthProvider","setUser","Provider","form","clear","useContext"],"mappings":"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","file":"static/js/main.70dcf301.chunk.js","sourcesContent":["import { Modal } from \"antd\";\r\nimport { QueryKey, useQueryClient } from \"react-query\";\r\n\r\nexport const useConfig = (\r\n  queryKey: QueryKey,\r\n  callBack: (target?: any, old?: any[]) => any[],\r\n  wrangingMsg?: (...args: any[]) => void\r\n) => {\r\n  const queryClient = useQueryClient();\r\n  return {\r\n    onSuccess() {\r\n      queryClient.invalidateQueries(queryKey);\r\n    },\r\n    async onMutate(target: any) {\r\n      queryClient.cancelQueries(queryKey); // 清除原来的查询，防止乐观更新相互覆盖\r\n      const previousItems = queryClient.getQueryData(queryKey);\r\n      queryClient.setQueryData(queryKey, (old?: any[]) => {\r\n        return callBack(target, old);\r\n      });\r\n      return { previousItems }; // 返回值会传给onError和onSettled\r\n    },\r\n    onError(error: any, newItem: any, context: any) {\r\n      // context 由onMutate传进来的参数\r\n      //问题：乐观更新失败，进行回滚时没有任何提示\r\n      wrangingMsg && wrangingMsg();\r\n      queryClient.setQueryData(queryKey, context.previousItems);\r\n    },\r\n  };\r\n};\r\n\r\nconst wrangMsg = (msgTitle: string, msgContent: string) => () =>\r\n  Modal.warning({\r\n    title: msgTitle,\r\n    content: msgContent,\r\n  });\r\n\r\nexport const useDeleteConfig = (queryKey: QueryKey) =>\r\n  useConfig(\r\n    queryKey,\r\n    (target, old) => old?.filter((item) => item.id !== target.id) || [],\r\n    wrangMsg(\"未知错误\", \"操作失败，请再次进行！\")\r\n  );\r\n\r\nexport const useEditConfig = (queryKey: QueryKey) =>\r\n  useConfig(\r\n    queryKey,\r\n    (target, old) =>\r\n      old?.map((item) => item.id === target.id ? { ...item, ...target } : item\r\n        \r\n      ) || [],\r\n    wrangMsg(\"未知错误\", \"操作失败，请再次进行！\")\r\n  );\r\n\r\nexport const useAddConfig = (queryKey: QueryKey) =>\r\n  useConfig(\r\n    queryKey,\r\n    (target, old) => (old ? [...old, target] : []),\r\n    wrangMsg(\"未知错误\", \"操作失败，请再次进行！\")\r\n  );\r\n","import { useHttp } from \"./http\";\r\nimport { QueryKey, useMutation, useQuery } from \"react-query\";\r\nimport { useAddConfig, useDeleteConfig, useEditConfig } from \"./use-optimistic-options\";\r\nimport { Project } from \"../types/project\";\r\nimport { Task } from \"../types/task\";\r\nimport { cleanObject } from \".\";\r\n\r\nexport const useProjects = (param?: Partial<Project>) => {\r\n  const client = useHttp();\r\n  return useQuery<Project[], Error>([\"projects\", cleanObject(param)], () =>\r\n    client(\"projects\", { data: param })\r\n  );\r\n};\r\n\r\nexport const useEditProject = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n  const config = useEditConfig(queryKey)\r\n  return useMutation(\r\n    (params: Partial<Project>) => client(`projects/${params.id}`, {\r\n      method: \"PATCH\",\r\n      data: params,\r\n    }),\r\n    config\r\n  );\r\n};\r\n\r\nexport const useAddProject = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n  return useMutation(\r\n    (params: Partial<Project>) =>\r\n      client(`projects`, {\r\n        data: params,\r\n        method: \"POST\",\r\n      }),\r\n      useAddConfig(queryKey)\r\n  );\r\n};\r\n\r\nexport const useProject = (id?: number) => {\r\n  const client = useHttp();\r\n  return useQuery<Project>(\r\n    [\"project\",  id ],\r\n    () => client(`projects/${id}`),\r\n    { enabled: !!id }\r\n  ); //id可以直接传吗？不用对象的形式\r\n};\r\n\r\nexport const useDeleteProject = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n  return useMutation(\"projects\", ({ id }: {id: number}) => client(`projects/${id}`, {\r\n      method: \"DELETE\",\r\n    }),\r\n    useDeleteConfig(queryKey)\r\n  ) \r\n}\r\n\r\nexport const useEditTask = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n  const config = useEditConfig(queryKey)\r\n  return useMutation(\r\n    (params: Partial<Task>) => client(`tasks/${params.id}`, {\r\n      method: \"PATCH\",\r\n      data: params,\r\n    }),\r\n    config\r\n  );\r\n};","import { useCallback } from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useMountedRef } from \".\";\r\n\r\ninterface State<D> {\r\n  error: Error | null;\r\n  data: D | null;\r\n  stat: \"idle\" | \"loading\" | \"error\" | \"success\";\r\n}\r\n\r\nconst defaultInitialState: State<null> = {\r\n  stat: \"idle\",\r\n  data: null,\r\n  error: null,\r\n};\r\n\r\nconst defaultConfig = {\r\n  throwOnError: false,\r\n};\r\n\r\nexport const useAsync = <D>(\r\n  initialState?: State<D>,\r\n  config = defaultConfig\r\n) => {\r\n  const [state, setState] = useState<State<D>>({\r\n    ...defaultInitialState,\r\n    ...initialState,\r\n  });\r\n\r\n  const setData = useCallback(\r\n    (data: D) =>\r\n      setState({\r\n        data,\r\n        stat: \"success\",\r\n        error: null,\r\n      }),\r\n    []\r\n  );\r\n\r\n  const setError = useCallback(\r\n    (error: Error) =>\r\n      setState({\r\n        data: null,\r\n        stat: \"error\",\r\n        error,\r\n      }),\r\n    []\r\n  );\r\n  const mountedRef = useMountedRef();\r\n\r\n  const [retry, setRetry] = useState(() => () => {});\r\n\r\n  const run = useCallback(\r\n    (\r\n      promise: Promise<D>,\r\n      runConfig?: {\r\n        retry: () => Promise<D>;\r\n      }\r\n    ) => {\r\n      if (!promise || !promise.then()) {\r\n        throw new Error(\"请传入Promise类型数据\");\r\n      }\r\n      setState(prevState => ({\r\n        ...prevState,\r\n        stat: \"loading\",\r\n      }));\r\n      setRetry(() => () => runConfig && run(runConfig.retry(), runConfig));\r\n      return promise\r\n        .then((data) => {\r\n          if (mountedRef.current) {\r\n            setData(data);\r\n          }\r\n          return data;\r\n        })\r\n        .catch((error) => {\r\n          setError(error);\r\n          if (config.throwOnError) {\r\n            return Promise.reject(error);\r\n          } else {\r\n            return error;\r\n          }\r\n        });\r\n    },\r\n    [config.throwOnError, mountedRef, setData, setError]\r\n  );\r\n  return {\r\n    isIdle: state.stat === \"idle\",\r\n    isLoading: state.stat === \"loading\",\r\n    isSuccess: state.stat === \"success\",\r\n    isError: state.stat === \"error\",\r\n    run,\r\n    setData,\r\n    setError,\r\n    retry,\r\n    ...state,\r\n  };\r\n};\r\n","import React from \"react\"\r\n\r\ntype fallbackRender = (props: {error: Error | null}) => React.ReactElement\r\nexport class ErrorBoundary extends React.Component<React.PropsWithChildren<{fallbackRender: fallbackRender}>, { error: Error | null}> {\r\n    state = {error : null}\r\n    static getDerivedStateFromError(error: Error) {\r\n        return {error}\r\n    }\r\n\r\n    render() {\r\n        const { error } = this.state\r\n        const { fallbackRender, children} = this.props\r\n        if(error) {\r\n            return fallbackRender({error})\r\n        } else {\r\n            return children\r\n        }\r\n    }\r\n}","import { useAuth } from \"./context/auth_context\"\r\n// import { UnauthenticatedApp } from \"./unauthenticated-app\"\r\n// import { AuthenticatedApp } from \"./authenticated-app\"\r\nimport \"./App.css\"\r\nimport { ErrorBoundary } from \"./components/error-boundary\"\r\nimport { FullPageErrorFallBack, FullPageLoading } from \"./components/lib\"\r\nimport React from \"react\"\r\n\r\nconst AuthenticatedApp = React.lazy(() => import(\"./authenticated-app\"));\r\nconst UnauthenticatedApp = React.lazy(() => import(\"./unauthenticated-app\"));\r\n\r\nfunction App() {\r\n  const { user } = useAuth()\r\n  return (\r\n    <div className=\"App\">\r\n      <ErrorBoundary fallbackRender={FullPageErrorFallBack}>\r\n        <React.Suspense fallback={<FullPageLoading />}>\r\n        {user ? <AuthenticatedApp /> : <UnauthenticatedApp />}\r\n        </React.Suspense>\r\n      </ErrorBoundary>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default App\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import { ReactNode } from \"react\";\r\nimport { AuthProvider } from \"./auth_context\";\r\nimport { QueryClientProvider, QueryClient } from \"react-query\";\r\nimport React from \"react\"\r\n\r\nexport const AppProviders = ({ children }: { children: ReactNode }) => {\r\n  return (\r\n    <QueryClientProvider client={new QueryClient()}>\r\n      <AuthProvider>{children}</AuthProvider>\r\n    </QueryClientProvider>\r\n  );\r\n};\r\n","import React, { ProfilerOnRenderCallback, ProfilerProps } from \"react\";\r\n\r\ntype Props = { metadata?: any; phases?: (\"mount\" | \"update\")[] } & Omit<\r\n  ProfilerProps,\r\n  \"onRender\"\r\n>;\r\n\r\nlet queue: unknown[] = [];\r\n\r\nconst sendProfileQueue = () => {\r\n  if (queue.length === 0) return;\r\n  const queueTosend = [...queue];\r\n  queue = [];\r\n  console.log(queueTosend);\r\n};\r\n\r\nsetInterval(sendProfileQueue, 5000);\r\n\r\nexport const Profiler = ({ metadata, phases, ...props }: Props) => {\r\n  const reportProfile: ProfilerOnRenderCallback = (\r\n    id,\r\n    phase,\r\n    actualDuration,\r\n    baseDuration,\r\n    startTime,\r\n    commitTime,\r\n    interactions\r\n  ) => {\r\n    if (!phases || phases.includes(phase)) {\r\n      queue.push({\r\n        id,\r\n        phase,\r\n        actualDuration,\r\n        baseDuration,\r\n        startTime,\r\n        commitTime,\r\n        interactions,\r\n        metadata\r\n      });\r\n    }\r\n  };\r\n  return <React.Profiler onRender={reportProfile} {...props}></React.Profiler>;\r\n};\r\n","import \"./wdyr\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nimport reportWebVitals from \"./reportWebVitals\";\r\nimport { DevTools, loadServer } from \"jira-dev-tool\";\r\nimport \"antd/dist/antd.less\";\r\nimport { AppProviders } from \"./context/index\";\r\nimport { Profiler } from \"./components/profiler\";\r\n\r\nloadServer(() =>\r\n  ReactDOM.render(\r\n    <React.StrictMode>\r\n      <Profiler id={\"Root App\"} phases={[\"mount\"]}>\r\n        <AppProviders>\r\n          <DevTools />\r\n          <App />\r\n        </AppProviders>\r\n      </Profiler>\r\n    </React.StrictMode>,\r\n    document.getElementById(\"root\")\r\n  )\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","import * as qs from \"qs\";\r\nimport { useCallback } from \"react\";\r\nimport * as auth from \"../auth-provider\";\r\nimport { useAuth } from \"../context/auth_context\";\r\n\r\nconst apiUrl = process.env.REACT_APP_API_URL;\r\n\r\ninterface Config extends RequestInit {\r\n  token?: string;\r\n  data?: object;\r\n}\r\n\r\nexport const http = async (\r\n  endpoint: String,\r\n  { data, token, headers, ...customConfig }: Config = {}\r\n) => {\r\n  const config = {\r\n    method: \"GET\",\r\n    headers: {\r\n      Authorization: token ? `Bearer ${token}` : \"\",\r\n      \"Content-Type\": data ? \"application/json\" : \"\",\r\n    },\r\n    // customConfig 可以覆盖上面的内容\r\n    ...customConfig,\r\n  };\r\n  if (config.method.toUpperCase() === \"GET\") {\r\n    endpoint += `?${qs.stringify(data)}`;\r\n  } else {\r\n    config.body = JSON.stringify(data || {});\r\n  }\r\n\r\n  return window\r\n    .fetch(`${apiUrl}/${endpoint}`, config)\r\n    .then(async (response) => {\r\n      if (response.status === 401) {\r\n        await auth.logout();\r\n        window.location.reload();\r\n        return Promise.reject({ message: \"请重新登录\" });\r\n      }\r\n      const data = await response.json();\r\n      if (response.ok) {\r\n        return data;\r\n      } else {\r\n        return Promise.reject(data);\r\n      }\r\n    });\r\n};\r\n\r\nexport const useHttp = () => {\r\n  const { user } = useAuth();\r\n\r\n  return useCallback(\r\n    (...[endpoint, config]: Parameters<typeof http>) =>\r\n      http(endpoint, { ...config, token: user?.token }),\r\n    [user?.token]\r\n  );\r\n};\r\n","import { User } from \"./types/user\"\r\n\r\nconst localStorageKey = \"__auth_provider_token__\"\r\nconst apiUrl = process.env.REACT_APP_API_URL\r\n\r\nexport const getToken = () => window.localStorage.getItem(localStorageKey)\r\n\r\nexport const handleUserResponse = ({user}: {user: User}) => {\r\n    window.localStorage.setItem(localStorageKey, user.token || \"\")\r\n    return user\r\n}\r\n\r\nexport const login = (data: {username:string, password: string}) => {\r\n    return fetch(`${apiUrl}/login`, {\r\n        method: \"POST\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(data)\r\n    }).then(async (response) => {\r\n        if(response.ok) {\r\n            return handleUserResponse(await response.json())\r\n        } else {\r\n            return Promise.reject(await response.json())\r\n        }\r\n    })\r\n}\r\n\r\nexport const register = (data: {username:string, password: string}) => {\r\n    return fetch(`${apiUrl}/register`, {\r\n        method: \"POST\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(data)\r\n    }).then(async response => {\r\n        if(response.ok) {\r\n            return handleUserResponse(await response.json())\r\n        } else {\r\n            return Promise.reject(await response.json())\r\n        }\r\n    })\r\n}\r\n\r\nexport const logout = async () => window.localStorage.removeItem(localStorageKey)","import { Modal } from \"antd\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { useLocation } from \"react-router\";\r\nimport { useProject } from \"./project\";\r\n\r\nexport const isVoid = (value: unknown) =>\r\n  value === undefined || value === null || value === \"\" ? true : false;\r\n\r\nexport const cleanObject = (object?: { [key: string]: unknown }) => {\r\n  if(!object) return {};\r\n  const result = { ...object };\r\n  Object.keys(object).forEach((key) => {\r\n    const value = object[key];\r\n    if (isVoid(value)) {\r\n      delete result[key];\r\n    }\r\n  });\r\n  return result;\r\n};\r\n\r\nexport const useMount = (callback: () => void) => {\r\n  useEffect(() => {\r\n    callback();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n};\r\n\r\nexport const useDebounce = <T>(value: T, delay?: number) => {\r\n  const [debounceValue, setDebounceValue] = useState(value);\r\n  useEffect(() => {\r\n    const timeOut = setTimeout(() => {\r\n      setDebounceValue(value);\r\n    }, delay);\r\n    return () => clearTimeout(timeOut);\r\n  }, [value, delay]);\r\n  return debounceValue;\r\n};\r\n\r\nexport const useArray = <T>(person: T[]) => {\r\n  const [value, setValue] = useState(person);\r\n  return {\r\n    value,\r\n    clear: () => setValue([]),\r\n    removeIndex: (idx: number) => {\r\n      setValue(value.filter((e, i) => i !== idx));\r\n    },\r\n    add: (item: T) => setValue([...value, item]),\r\n  };\r\n};\r\n\r\nexport const useDocumentTitle = (title: string, keepOnUnmount = true) => {\r\n  const oldTitle = useRef(document.title).current;\r\n\r\n  useEffect(() => {\r\n    document.title = title;\r\n  }, [title]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (!keepOnUnmount) {\r\n        document.title = oldTitle;\r\n      }\r\n    };\r\n  }, [keepOnUnmount, oldTitle]);\r\n};\r\n\r\nexport const resetRoute = () => (window.location.href = window.location.origin);\r\n\r\nexport const useMountedRef = () => {\r\n  const mountedRef = useRef(false);\r\n  useEffect(() => {\r\n    mountedRef.current = true;\r\n    return () => {\r\n      mountedRef.current = false;\r\n    };\r\n  });\r\n  return mountedRef;\r\n};\r\n\r\nexport const useProjectIdInUrl = () => {\r\n  const { pathname } = useLocation();\r\n  const id = pathname.match(/projects\\/(\\d+)\\//)?.[1];\r\n  return Number(id);\r\n};\r\n\r\nexport const useProjectInUrl = () => useProject(useProjectIdInUrl());\r\n\r\nexport const delComfirmModal = (\r\n  mutate: ({ id }: { id: number }) => void,\r\n  id: number,\r\n  confirmTitle: string,\r\n  confirmContent?: string\r\n) => {\r\n  Modal.confirm({\r\n    title: confirmTitle,\r\n    content: confirmContent,\r\n    onOk() {\r\n      mutate({ id });\r\n    },\r\n    cancelText: \"取消\",\r\n    okText: \"确定\",\r\n    maskClosable: true,\r\n  });\r\n};\r\n","import styled from \"@emotion/styled\";\r\nimport { Button, Spin, Typography } from \"antd\";\r\nimport { DevTools } from \"jira-dev-tool\";\r\nimport React from \"react\"\r\n\r\nexport const Row = styled.div<{\r\n  gap?: number | boolean;\r\n  between?: boolean;\r\n  marginBottom?: number | boolean;\r\n}>`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: ${(props) => (props.between ? \"space-between\" : undefined)};\r\n  margin-bottom: ${(props) => props.marginBottom + \"rem\"};\r\n  > * {\r\n    margin-top: 0 !important;\r\n    margin-bottom: 0 !important;\r\n    margin-right: ${(props) =>\r\n      typeof props.gap === \"number\"\r\n        ? props.gap + \"rem\"\r\n        : props.gap\r\n        ? \"2rem\"\r\n        : undefined};\r\n  }\r\n`;\r\n\r\nconst FullPage = styled.div`\r\n  height: 100vh;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n`;\r\n\r\nexport const FullPageLoading = () => (\r\n  <FullPage>\r\n    <Spin size={\"large\"} />\r\n  </FullPage>\r\n);\r\n\r\nexport const FullPageErrorFallBack = ({ error }: { error: Error | null }) => (\r\n  <FullPage>\r\n    <DevTools />\r\n    <ErrorBox error={error}></ErrorBox>\r\n  </FullPage>\r\n);\r\n\r\nexport const ButtonNoPadding = styled(Button)`\r\n  padding: 0;\r\n`;\r\n\r\nconst isError = (value: any): value is Error => value?.message;\r\n\r\nexport const ErrorBox = ({ error }: { error: unknown }) => {\r\n  if (isError(error)) {\r\n    return <Typography.Text type={\"danger\"}>{error.message}</Typography.Text>;\r\n  } else return null;\r\n};\r\n\r\nexport const ScreenContainer = styled.div`\r\n  padding: 3.2rem;\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n`","import React from \"react\"\r\nimport { useQueryClient } from \"react-query\";\r\nimport * as auth from \"../auth-provider\"\r\nimport { FullPageErrorFallBack, FullPageLoading } from \"../components/lib\";\r\nimport { User } from \"../types/user\";\r\nimport { useMount } from \"../utils\";\r\nimport { http } from \"../utils/http\";\r\nimport { useAsync } from \"../utils/use-async\";\r\n\r\ninterface AuthForm {\r\n    username: string,\r\n    password: string\r\n}\r\n\r\nconst bootstrapUser = async () => {\r\n    let user = null;\r\n    const token = auth.getToken()\r\n    if(token) {\r\n        const data = await http(\"me\", {\r\n            token\r\n        })\r\n        user = data.user\r\n    }\r\n    return user\r\n}\r\n\r\nconst AuthContext = React.createContext<{\r\n    user: User|null;\r\n    login: (form: AuthForm) => Promise<void>;\r\n    register: (form: AuthForm) => Promise<void>;\r\n    logout: () => Promise<void>\r\n}| undefined>(undefined)\r\nAuthContext.displayName = \"AuthContext\"\r\n\r\nexport const AuthProvider = ({children}: {children: React.ReactNode}) => {\r\n    const client = useQueryClient();\r\n    const { data: user, error, isLoading, isIdle, isError, run, setData: setUser } = useAsync<User | null>()\r\n    const login = (form: AuthForm) => auth.login(form).then(setUser)\r\n    const register = (form: AuthForm) => auth.register(form).then(setUser)\r\n    const logout = () => auth.logout().then(() => {\r\n        setUser(null);\r\n        client.clear();\r\n    })\r\n\r\n    useMount(() => {\r\n        run(bootstrapUser())\r\n    })\r\n    if(isIdle || isLoading) {\r\n        return <FullPageLoading />\r\n    }\r\n    if(isError) {\r\n        return <FullPageErrorFallBack error={error}/>\r\n    }\r\n    return <AuthContext.Provider children={children} value={{user, login, register, logout}} />\r\n}\r\n\r\nexport const useAuth = () => {\r\n    const context = React.useContext(AuthContext)\r\n    if(!context) {\r\n        throw new Error(\"useAuth必须在AuthProvider中使用\")\r\n    }\r\n    return context\r\n}\r\n"],"sourceRoot":""}